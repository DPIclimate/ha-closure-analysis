<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.5"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Oyster Harvest Area Closure Analysis: src/utils.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Oyster Harvest Area Closure Analysis<span id="projectnumber">&#160;0.1</span>
   </div>
   <div id="projectbrief">Prediction and analysis of NSW oyster harvest area closures.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('utils_8c.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">utils.c File Reference</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &quot;<a class="el" href="utils_8h_source.html">utils.h</a>&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for utils.c:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="utils_8c__incl.svg" width="1163" height="256"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:abd11b076bf3b435e484a1880c77343ee"><td class="memItemLeft" align="right" valign="top">size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="utils_8c.html#abd11b076bf3b435e484a1880c77343ee">WriteMemoryCallback</a> (void *contents, size_t size, size_t nmemb, void *userp)</td></tr>
<tr class="separator:abd11b076bf3b435e484a1880c77343ee"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6885b6b56d62d9d96fc7682c122bb719"><td class="memItemLeft" align="right" valign="top">int8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="utils_8c.html#a6885b6b56d62d9d96fc7682c122bb719">MakeDirectory</a> (const char *directory)</td></tr>
<tr class="memdesc:a6885b6b56d62d9d96fc7682c122bb719"><td class="mdescLeft">&#160;</td><td class="mdescRight">Make directories (with error handling)  <a href="utils_8c.html#a6885b6b56d62d9d96fc7682c122bb719">More...</a><br /></td></tr>
<tr class="separator:a6885b6b56d62d9d96fc7682c122bb719"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aae3626bba6a021ce94bdfed42c1dbdb9"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="utils_8c.html#aae3626bba6a021ce94bdfed42c1dbdb9">WriteTimeseriesToFile</a> (const char *filename, time_t *dates, double *values, int16_t max_n_values)</td></tr>
<tr class="memdesc:aae3626bba6a021ce94bdfed42c1dbdb9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Write timeseries data into a csv file.  <a href="utils_8c.html#aae3626bba6a021ce94bdfed42c1dbdb9">More...</a><br /></td></tr>
<tr class="separator:aae3626bba6a021ce94bdfed42c1dbdb9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2dd2caaadd6c88b345799d955652f908"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="utils_8c.html#a2dd2caaadd6c88b345799d955652f908">cJSON_Minify_Mod</a> (char *json)</td></tr>
<tr class="memdesc:a2dd2caaadd6c88b345799d955652f908"><td class="mdescLeft">&#160;</td><td class="mdescRight">Modified minify function from cJSON.  <a href="utils_8c.html#a2dd2caaadd6c88b345799d955652f908">More...</a><br /></td></tr>
<tr class="separator:a2dd2caaadd6c88b345799d955652f908"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae9a4fc4203f0487ffc856084f3e4a8a6"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="utils_8c.html#ae9a4fc4203f0487ffc856084f3e4a8a6">Utils_PointsDistance</a> (double latitude, double longitude, double station_latitude, double station_longitude)</td></tr>
<tr class="memdesc:ae9a4fc4203f0487ffc856084f3e4a8a6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Distance between two points on earth.  <a href="utils_8c.html#ae9a4fc4203f0487ffc856084f3e4a8a6">More...</a><br /></td></tr>
<tr class="separator:ae9a4fc4203f0487ffc856084f3e4a8a6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afdc0b49cf1b8441d00d0876ab599ccbd"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="utils_8c.html#afdc0b49cf1b8441d00d0876ab599ccbd">Utils_PrepareStatement</a> (PGconn *psql_conn, const char *stmt_name, const char *stmt, const int nparams)</td></tr>
<tr class="separator:afdc0b49cf1b8441d00d0876ab599ccbd"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a id="a2dd2caaadd6c88b345799d955652f908" name="a2dd2caaadd6c88b345799d955652f908"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2dd2caaadd6c88b345799d955652f908">&#9670;&#160;</a></span>cJSON_Minify_Mod()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void cJSON_Minify_Mod </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>json</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Modified minify function from cJSON. </p>
<p >HTML minify function modified from cJSON library.</p>
<p >The main cJSON_Minify() function gets rid of all white space and '/' characters in a string. This however, causes sentances to appear without the nessessary spaces between words. This modified function keeps only one space between each character (if more than one space occurs) and maintains the spaces between words in a sentance. Additionally '/' characters are maintained as they are used as datetime delimiters.</p>
<dl class="section see"><dt>See also</dt><dd><a href="https://github.com/DaveGamble/cJSON/blob/master/cJSON.c#L2838">https://github.com/DaveGamble/cJSON/blob/master/cJSON.c#L2838</a></dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">json</td><td>The string to minify (parse). </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a6885b6b56d62d9d96fc7682c122bb719" name="a6885b6b56d62d9d96fc7682c122bb719"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6885b6b56d62d9d96fc7682c122bb719">&#9670;&#160;</a></span>MakeDirectory()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int8_t MakeDirectory </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>directory</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Make directories (with error handling) </p>
<p >Helper function to create directories with error handling.</p>
<div class="fragment"><div class="line"><a class="code hl_function" href="utils_8c.html#a6885b6b56d62d9d96fc7682c122bb719">MakeDirectory</a>(<span class="stringliteral">&quot;my_directory&quot;</span>);</div>
<div class="line"><a class="code hl_function" href="utils_8c.html#a6885b6b56d62d9d96fc7682c122bb719">MakeDirectory</a>(<span class="stringliteral">&quot;my_directory/my_sub_directory&quot;</span>);</div>
<div class="ttc" id="autils_8c_html_a6885b6b56d62d9d96fc7682c122bb719"><div class="ttname"><a href="utils_8c.html#a6885b6b56d62d9d96fc7682c122bb719">MakeDirectory</a></div><div class="ttdeci">int8_t MakeDirectory(const char *directory)</div><div class="ttdoc">Make directories (with error handling)</div><div class="ttdef"><b>Definition:</b> utils.c:60</div></div>
</div><!-- fragment --><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">directory</td><td>Directory name you want to create. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Integer representing error status. 0 = OK ... 1 = ERROR </dd></dl>

</div>
</div>
<a id="ae9a4fc4203f0487ffc856084f3e4a8a6" name="ae9a4fc4203f0487ffc856084f3e4a8a6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae9a4fc4203f0487ffc856084f3e4a8a6">&#9670;&#160;</a></span>Utils_PointsDistance()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double Utils_PointsDistance </td>
          <td>(</td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>latitude</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>longitude</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>station_latitude</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>station_longitude</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Distance between two points on earth. </p>
<p >Uses haversine formula to calculate the distance in km between two points on earth.</p>
<p >Used to calculate the distance between an POI and the closest Bureau of Meterology station.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">latitude</td><td>Latitude of point of interest. </td></tr>
    <tr><td class="paramname">longitude</td><td>Longitude of point of interest. </td></tr>
    <tr><td class="paramname">station_latitude</td><td>Latitude of station. </td></tr>
    <tr><td class="paramname">station_longitude</td><td>Longitude of station. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Distance between two points on earth in km. </dd></dl>

</div>
</div>
<a id="afdc0b49cf1b8441d00d0876ab599ccbd" name="afdc0b49cf1b8441d00d0876ab599ccbd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afdc0b49cf1b8441d00d0876ab599ccbd">&#9670;&#160;</a></span>Utils_PrepareStatement()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Utils_PrepareStatement </td>
          <td>(</td>
          <td class="paramtype">PGconn *&#160;</td>
          <td class="paramname"><em>psql_conn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>stmt_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>stmt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&#160;</td>
          <td class="paramname"><em>nparams</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="abd11b076bf3b435e484a1880c77343ee" name="abd11b076bf3b435e484a1880c77343ee"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abd11b076bf3b435e484a1880c77343ee">&#9670;&#160;</a></span>WriteMemoryCallback()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">size_t WriteMemoryCallback </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>contents</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>nmemb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>userp</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p >Callback function to save HTTP response data to a character array.</p>
<p >CURL defaults to printing to stdout. This function is added to CURL in the setup options (curl_easy_setupopt()). Memory is allocated and then filled with the response string. This character array is then used to create cJSON objects and other items.</p>
<div class="fragment"><div class="line">MemoryStruct_TypeDef chunk;</div>
<div class="line">chunk.memory = malloc(1);</div>
<div class="line">chunk.size = 0;</div>
<div class="line">curl_easy_setopt(curl, CURLOPT_WRITEFUNCTION, <a class="code hl_function" href="utils_8c.html#abd11b076bf3b435e484a1880c77343ee">WriteMemoryCallback</a>);</div>
<div class="line">curl_easy_setopt(curl, CURLOPT_WRITEDATA, (<span class="keywordtype">void</span> *)&amp;chunk);</div>
<div class="line">free(chunk.memory) <span class="comment">// Don&#39;t forget to free allocation</span></div>
<div class="ttc" id="autils_8c_html_abd11b076bf3b435e484a1880c77343ee"><div class="ttname"><a href="utils_8c.html#abd11b076bf3b435e484a1880c77343ee">WriteMemoryCallback</a></div><div class="ttdeci">size_t WriteMemoryCallback(void *contents, size_t size, size_t nmemb, void *userp)</div><div class="ttdef"><b>Definition:</b> utils.c:28</div></div>
</div><!-- fragment --><dl class="section see"><dt>See also</dt><dd><a href="https://curl.se/libcurl/c/getinmemory.html">https://curl.se/libcurl/c/getinmemory.html</a></dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">contents</td><td>The items to add. </td></tr>
    <tr><td class="paramname">size</td><td>The size of items to add. </td></tr>
    <tr><td class="paramname">nmemb</td><td>The number of members (data size). </td></tr>
    <tr><td class="paramname">userp</td><td>The struct to populate with data. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The size of received data. </dd></dl>

</div>
</div>
<a id="aae3626bba6a021ce94bdfed42c1dbdb9" name="aae3626bba6a021ce94bdfed42c1dbdb9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aae3626bba6a021ce94bdfed42c1dbdb9">&#9670;&#160;</a></span>WriteTimeseriesToFile()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void WriteTimeseriesToFile </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>filename</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">time_t *&#160;</td>
          <td class="paramname"><em>dates</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>values</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int16_t&#160;</td>
          <td class="paramname"><em>max_n_values</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Write timeseries data into a csv file. </p>
<p >Helper function to handle writing timeseries data to a .csv file.</p>
<p >Writes timeseries data to a filename, exiting when the data is un-initialised '\0' or the maxiumum buffer size is reached. This function also converts UNIX time into local (human readable) time in ISO 8601 format.</p>
<div class="fragment"><div class="line"><span class="comment">// Build filename (directory requried)</span></div>
<div class="line"><span class="keywordtype">char</span> filename[100];</div>
<div class="line">sprintf(filename, <span class="stringliteral">&quot;%s/low.csv&quot;</span>, directory);</div>
<div class="line"><a class="code hl_function" href="utils_8c.html#aae3626bba6a021ce94bdfed42c1dbdb9">WriteTimeseriesToFile</a>(filename,</div>
<div class="line">                      dataset-&gt;low_tide_timestamps, <span class="comment">// UNIX timestamps</span></div>
<div class="line">                      dataset-&gt;low_tide_values, <span class="comment">// Values</span></div>
<div class="line">                      <a class="code hl_define" href="forecast_8h.html#af2b3c9f9af17e84515bc95abcb995c00">WW_FORECAST_RESPONSE_BUF</a>); <span class="comment">// Max number of values</span></div>
<div class="ttc" id="aforecast_8h_html_af2b3c9f9af17e84515bc95abcb995c00"><div class="ttname"><a href="forecast_8h.html#af2b3c9f9af17e84515bc95abcb995c00">WW_FORECAST_RESPONSE_BUF</a></div><div class="ttdeci">#define WW_FORECAST_RESPONSE_BUF</div><div class="ttdoc">Max response values.</div><div class="ttdef"><b>Definition:</b> forecast.h:22</div></div>
<div class="ttc" id="autils_8c_html_aae3626bba6a021ce94bdfed42c1dbdb9"><div class="ttname"><a href="utils_8c.html#aae3626bba6a021ce94bdfed42c1dbdb9">WriteTimeseriesToFile</a></div><div class="ttdeci">void WriteTimeseriesToFile(const char *filename, time_t *dates, double *values, int16_t max_n_values)</div><div class="ttdoc">Write timeseries data into a csv file.</div><div class="ttdef"><b>Definition:</b> utils.c:107</div></div>
</div><!-- fragment --><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">filename</td><td>File to write to. </td></tr>
    <tr><td class="paramname">dates</td><td>Dates (x values). </td></tr>
    <tr><td class="paramname">values</td><td>Data values (y values). </td></tr>
    <tr><td class="paramname">max_n_values</td><td>Max buffer size. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="utils_8c.html">utils.c</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.5 </li>
  </ul>
</div>
</body>
</html>
